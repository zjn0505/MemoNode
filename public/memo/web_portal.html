<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <link rel="shortcut icon" href="./icon/favicon.ico" type="image/x-icon">
    <link rel="icon" href="./icon/favicon.ico" type="image/x-icon">
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->
  <script>
    function postMemo(oFormElement) {
      var http = new createCORSRequest(oFormElement.method, oFormElement.action);
      http.open(oFormElement.method, oFormElement.action, true);
      http.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
      http.onreadystatechange = function() {
        if(http.readyState == 4 && http.status == 200) {
            var json = JSON.parse(http.response);
            var alertSuccess = document.getElementById("push_success");
            alertSuccess.innerHTML = "<strong>Success!</strong> You have created a memo with id <strong>"+json.memo._id+"</strong>.";
            alertSuccess.style.display = "inherit"

        }
      }
      http.onload = function () {
          // do something to response
          console.log(this.responseText);
      };
      var data = new FormData(oFormElement);
      http.send(urlencodeFormData(data));
      return false;
    }

    function createCORSRequest(method, url) {
      var xhr = new XMLHttpRequest();
      if ("withCredentials" in xhr) {
        // XHR for Chrome/Firefox/Opera/Safari.
        xhr.open(method, url, true);
      } else if (typeof XDomainRequest != "undefined") {
        // XDomainRequest for IE.
        xhr = new XDomainRequest();
        xhr.open(method, url);
      } else {
        // CORS not supported.
        xhr = null;
        console.log("not support CORS");
      }
      return xhr;
    }

    function urlencodeFormData(fd){
    var s = '';
    function encode(s){ return encodeURIComponent(s).replace(/%20/g,'+'); }
      for(var pair of fd.entries()){
          if(typeof pair[1]=='string'){
              s += (s?'&':'') + encode(pair[0])+'='+encode(pair[1]);
          }
      }
      return s;
    }

  </script>
  </head>
  <body>

  <div class="container-fluid">
    <div class="row">
      <div class="col-xs-2 col-sm-1" style="width: 60px" >
        <img  alt="Pullsh" src="./icon/ic_pullsh.png">
      </div>
       <div class="col-xs-10 col-sm-11">
        <ul class="nav nav-tabs" style="margin-top: 3px">
          <li class="active"><a data-toggle="tab" href="#pullsh">Pullsh</a></li>
          <li><a data-toggle="tab" href="#history">History</a></li>
          <li><a data-toggle="tab" href="#about">About</a></li>
        </ul>
      </div>
    </div>
  </div>
 
  <div class="tab-content">
    <div id="pullsh" class="tab-pane fade in active">
      <div class="container">
        <h1>Create a memo</h1>
        <div class="row">
          <div class="col-xs-12 col-10">
            <form name="create_memo" method="post" onsubmit="return postMemo(this)" action="https://api.jienan.xyz/memo" target="dummyframe">
            <textarea id="push_input" name="msg" rows="10" style="width:100%; resize:none;"></textarea>
            <br />
            <input type="submit" value="Create" /></form>
          </div>
        </div>
        <p>
        <div class="alert alert-success" id="push_success" style="display: none"></div>
      </div>
      <div class="container">
        <h1 id="memoId">Read a memo</h1>
        <form name="create_memo" method="get" enctype="multipart/x-www-form-urlencoded" action="https://api.jienan.xyz/memo">
        <!-- <textarea name="memoId" rows="2" style="resize: none"></textarea><br> -->
        <input type="text" name="memoId" class="form-control" style="width:100px" /> 
        <input type="hidden" name="client" value="web" /> 
        <input type="submit" value="Read" /></form>
      </div>
      <iframe width="0" height="0" border="0" name="dummyframe" id="dummyframe"></iframe>
    </div>
    <div id="history" class="tab-pane fade">
    <div class="container">
      <h3>Menu 1</h3>
      <p>Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</p>
    </div>
    </div>
    <div id="about" class="tab-pane fade">
      <h3>Menu 2</h3>
      <p>Sed ut perspiciatis unde omnis iste natus error sit voluptatem accusantium doloremque laudantium, totam rem aperiam.</p>
    </div>
  </div>
  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script>
    if (typeof(Storage) !== "undefined") {
      localStorage.setItem("pull_default", "input the memo id to create a pull");
      document.getElementById("memoId").title = localStorage.getItem("pull_default");
    } else {
      console.log("not support");
    }

  </script>
</html>