<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <link rel="shortcut icon" href="http://130.211.211.220:3001/icon/favicon.png" type="image/x-icon">
    <link rel="icon" href="http://130.211.211.220:3001/icon/favicon.png" type="image/x-icon">
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->
  <script>
    function postMemo(oFormElement) {
      var http = new createCORSRequest(oFormElement.method, oFormElement.action);
      http.open(oFormElement.method, oFormElement.action, true);
      http.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
      http.onreadystatechange = function() {
        if(http.readyState == 4 && http.status == 200) {
            var json = JSON.parse(http.response);
            var alertSuccess = document.getElementById("push_success");
            alertSuccess.innerHTML = "<strong>Success!</strong> You have created a memo with id <strong>"+json.memo._id+"</strong>.";
            alertSuccess.style.display = "inherit"

        }
      }
      http.onload = function () {
          // do something to response
          console.log(this.responseText);
      };
      var data = new FormData(oFormElement);
      http.send(urlencodeFormData(data));
      return false;
    }

    function createCORSRequest(method, url) {
      var xhr = new XMLHttpRequest();
      if ("withCredentials" in xhr) {
        // XHR for Chrome/Firefox/Opera/Safari.
        xhr.open(method, url, true);
      } else if (typeof XDomainRequest != "undefined") {
        // XDomainRequest for IE.
        xhr = new XDomainRequest();
        xhr.open(method, url);
      } else {
        // CORS not supported.
        xhr = null;
        console.log("not support CORS");
      }
      return xhr;
    }

    function urlencodeFormData(fd){
    var s = '';
    function encode(s){ return encodeURIComponent(s).replace(/%20/g,'+'); }
      for(var pair of fd.entries()){
          if(typeof pair[1]=='string'){
              s += (s?'&':'') + encode(pair[0])+'='+encode(pair[1]);
          }
      }
      return s;
    }

  </script>
  </head>
  <body>
  <nav class="navbar navbar-default">
  <div class="container-fluid">
    <div class="navbar-header">
		<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#myNavbar" aria-expanded="false" aria-controls="navbar"
		style="visibility:hidden">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
		</button>
      <a class="navbar-brand" href="#">
        <img alt="Pullsh" style="max-width:100px; margin-top: -13px;" src="http://130.211.211.220:3001/icon/ic_pullsh.png">
      </a>
    </div>
	<div id="myNavbar" class="navbar-collapse collapse">
    <ul class="nav navbar-nav" style="visibility:hidden">
      <li class="active"><a href="#">Memo</a></li>
      <li><a href="#">History</a></li>
      <li><a href="#">About</a></li>
    </ul>
  </div><!--/.nav-collapse -->
  </div>
  </nav>
  <div class="container" style="margin-top: -28px;">
    <h1>Create a memo</h1>
    <div class="row">
      <div class="col-xs-12 col-10">
        <form name="create_memo" method="post" onsubmit="return postMemo(this)" action="https://api.jienan.xyz/memo" target="dummyframe">
        <textarea id="push_input" name="msg" rows="10" style="width:100%; resize:none;"></textarea>
        <br />
        <input type="submit" value="Create" /></form>
      </div>
    </div>
    <p>
    <div class="alert alert-success" id="push_success" style="display: none"></div>
  </div>
  <div class="container">
    <h1 id="memoId">Read a memo</h1>
    <form name="create_memo" method="get" enctype="multipart/x-www-form-urlencoded" action="https://api.jienan.xyz/memo">
    <!-- <textarea name="memoId" rows="2" style="resize: none"></textarea><br> -->
    <input type="text" name="memoId" class="form-control" style="width:100px" /> 
    <input type="hidden" name="client" value="web" /> 
    <input type="submit" value="Read" /></form>
  </div>
  <iframe width="0" height="0" border="0" name="dummyframe" id="dummyframe"></iframe>
  <script src="https://code.jquery.com/jquery-2.1.3.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script>
    if (typeof(Storage) !== "undefined") {
      localStorage.setItem("pull_default", "input the memo id to create a pull");
      document.getElementById("memoId").title = localStorage.getItem("pull_default");
    } else {
      console.log("not support");
    }

  </script>
</html>